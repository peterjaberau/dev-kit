{
  "$ref": "#/definitions/AIOrchestration",
  "definitions": {
    "AIOrchestration": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z_][a-z0-9_]*$",
          "description": "Orchestration unique identifier (snake_case)"
        },
        "label": {
          "type": "string",
          "description": "Display name"
        },
        "description": {
          "type": "string"
        },
        "objectName": {
          "type": "string",
          "description": "Target object for this orchestration"
        },
        "trigger": {
          "type": "string",
          "enum": [
            "record_created",
            "record_updated",
            "field_changed",
            "scheduled",
            "manual",
            "webhook",
            "batch"
          ]
        },
        "fieldConditions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "field": {
                "type": "string",
                "description": "Field name to monitor"
              },
              "operator": {
                "type": "string",
                "enum": [
                  "changed",
                  "changed_to",
                  "changed_from",
                  "is",
                  "is_not"
                ],
                "default": "changed"
              },
              "value": {
                "description": "Value to compare against (for changed_to/changed_from/is/is_not)"
              }
            },
            "required": [
              "field"
            ],
            "additionalProperties": false
          },
          "description": "Fields to monitor (for field_changed trigger)"
        },
        "schedule": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "cron",
                "interval",
                "daily",
                "weekly",
                "monthly"
              ],
              "default": "cron"
            },
            "cron": {
              "type": "string",
              "description": "Cron expression (required if type is \"cron\")"
            },
            "interval": {
              "type": "number",
              "description": "Interval in minutes (required if type is \"interval\")"
            },
            "time": {
              "type": "string",
              "description": "Time of day for daily schedules (HH:MM format)"
            },
            "dayOfWeek": {
              "type": "integer",
              "minimum": 0,
              "maximum": 6,
              "description": "Day of week for weekly (0=Sunday)"
            },
            "dayOfMonth": {
              "type": "integer",
              "minimum": 1,
              "maximum": 31,
              "description": "Day of month for monthly"
            },
            "timezone": {
              "type": "string",
              "default": "UTC"
            }
          },
          "additionalProperties": false,
          "description": "Schedule configuration (for scheduled trigger)"
        },
        "webhookConfig": {
          "type": "object",
          "properties": {
            "secret": {
              "type": "string",
              "description": "Webhook verification secret"
            },
            "headers": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              },
              "description": "Expected headers"
            }
          },
          "additionalProperties": false,
          "description": "Webhook configuration (for webhook trigger)"
        },
        "entryCriteria": {
          "type": "string",
          "description": "Formula condition - workflow only runs if TRUE"
        },
        "aiTasks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Optional task ID for referencing"
              },
              "name": {
                "type": "string",
                "description": "Human-readable task name"
              },
              "type": {
                "type": "string",
                "enum": [
                  "classify",
                  "extract",
                  "summarize",
                  "generate",
                  "predict",
                  "translate",
                  "sentiment",
                  "entity_recognition",
                  "anomaly_detection",
                  "recommendation"
                ]
              },
              "model": {
                "type": "string",
                "description": "Model ID from registry (uses default if not specified)"
              },
              "promptTemplate": {
                "type": "string",
                "description": "Prompt template ID for this task"
              },
              "inputFields": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Source fields to process (e.g., [\"description\", \"comments\"])"
              },
              "inputSchema": {
                "type": "object",
                "additionalProperties": {},
                "description": "Validation schema for inputs"
              },
              "inputContext": {
                "type": "object",
                "additionalProperties": {},
                "description": "Additional context for the AI model"
              },
              "outputField": {
                "type": "string",
                "description": "Target field to store the result"
              },
              "outputSchema": {
                "type": "object",
                "additionalProperties": {},
                "description": "Validation schema for output"
              },
              "outputFormat": {
                "type": "string",
                "enum": [
                  "text",
                  "json",
                  "number",
                  "boolean",
                  "array"
                ],
                "default": "text"
              },
              "classes": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Valid classes for classification tasks"
              },
              "multiClass": {
                "type": "boolean",
                "default": false,
                "description": "Allow multiple classes to be selected"
              },
              "extractionSchema": {
                "type": "object",
                "additionalProperties": {},
                "description": "JSON schema for structured extraction"
              },
              "maxLength": {
                "type": "number",
                "description": "Maximum length for generated content"
              },
              "temperature": {
                "type": "number",
                "minimum": 0,
                "maximum": 2,
                "description": "Model temperature override"
              },
              "fallbackValue": {
                "description": "Fallback value if AI task fails"
              },
              "retryAttempts": {
                "type": "integer",
                "minimum": 0,
                "maximum": 5,
                "default": 1
              },
              "condition": {
                "type": "string",
                "description": "Formula condition - task only runs if TRUE"
              },
              "description": {
                "type": "string"
              },
              "active": {
                "type": "boolean",
                "default": true
              }
            },
            "required": [
              "name",
              "type",
              "inputFields",
              "outputField"
            ],
            "additionalProperties": false
          },
          "description": "AI tasks to execute in sequence"
        },
        "postActions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "field_update",
                  "send_email",
                  "create_record",
                  "update_related",
                  "trigger_flow",
                  "webhook"
                ]
              },
              "name": {
                "type": "string",
                "description": "Action name"
              },
              "config": {
                "type": "object",
                "additionalProperties": {},
                "description": "Action-specific configuration"
              },
              "condition": {
                "type": "string",
                "description": "Execute only if condition is TRUE"
              }
            },
            "required": [
              "type",
              "name",
              "config"
            ],
            "additionalProperties": false
          },
          "description": "Actions after AI tasks complete"
        },
        "executionMode": {
          "type": "string",
          "enum": [
            "sequential",
            "parallel"
          ],
          "default": "sequential",
          "description": "How to execute multiple AI tasks"
        },
        "stopOnError": {
          "type": "boolean",
          "default": false,
          "description": "Stop workflow if any task fails"
        },
        "timeout": {
          "type": "number",
          "description": "Maximum execution time in seconds"
        },
        "priority": {
          "type": "string",
          "enum": [
            "low",
            "normal",
            "high",
            "critical"
          ],
          "default": "normal"
        },
        "enableLogging": {
          "type": "boolean",
          "default": true
        },
        "enableMetrics": {
          "type": "boolean",
          "default": true
        },
        "notifyOnFailure": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "User IDs to notify on failure"
        },
        "active": {
          "type": "boolean",
          "default": true
        },
        "version": {
          "type": "string",
          "default": "1.0.0"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "category": {
          "type": "string",
          "description": "Workflow category (e.g., \"support\", \"sales\", \"hr\")"
        },
        "owner": {
          "type": "string",
          "description": "User ID of workflow owner"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp"
        }
      },
      "required": [
        "name",
        "label",
        "objectName",
        "trigger",
        "aiTasks"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}