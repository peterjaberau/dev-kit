{
  "$ref": "#/definitions/NLQResponse",
  "definitions": {
    "NLQResponse": {
      "type": "object",
      "properties": {
        "parseResult": {
          "type": "object",
          "properties": {
            "originalQuery": {
              "type": "string"
            },
            "intent": {
              "type": "string",
              "enum": [
                "select",
                "aggregate",
                "filter",
                "sort",
                "compare",
                "trend",
                "insight",
                "create",
                "update",
                "delete"
              ]
            },
            "intentConfidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "entities": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "object",
                      "field",
                      "value",
                      "operator",
                      "function",
                      "timeframe"
                    ]
                  },
                  "text": {
                    "type": "string",
                    "description": "Original text from query"
                  },
                  "value": {
                    "description": "Normalized value"
                  },
                  "confidence": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Confidence score"
                  },
                  "span": {
                    "type": "array",
                    "minItems": 2,
                    "maxItems": 2,
                    "items": [
                      {
                        "type": "number"
                      },
                      {
                        "type": "number"
                      }
                    ],
                    "description": "Character span in query"
                  }
                },
                "required": [
                  "type",
                  "text",
                  "confidence"
                ],
                "additionalProperties": false
              }
            },
            "targetObject": {
              "type": "string",
              "description": "Primary object to query"
            },
            "fields": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "naturalLanguage": {
                    "type": "string",
                    "description": "NL field name (e.g., \"customer name\")"
                  },
                  "objectField": {
                    "type": "string",
                    "description": "Actual field name (e.g., \"account.name\")"
                  },
                  "object": {
                    "type": "string",
                    "description": "Object name"
                  },
                  "field": {
                    "type": "string",
                    "description": "Field name"
                  },
                  "confidence": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  }
                },
                "required": [
                  "naturalLanguage",
                  "objectField",
                  "object",
                  "field",
                  "confidence"
                ],
                "additionalProperties": false
              }
            },
            "timeframe": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "absolute",
                    "relative"
                  ]
                },
                "start": {
                  "type": "string",
                  "description": "Start date (ISO format)"
                },
                "end": {
                  "type": "string",
                  "description": "End date (ISO format)"
                },
                "relative": {
                  "type": "object",
                  "properties": {
                    "unit": {
                      "type": "string",
                      "enum": [
                        "hour",
                        "day",
                        "week",
                        "month",
                        "quarter",
                        "year"
                      ]
                    },
                    "value": {
                      "type": "integer"
                    },
                    "direction": {
                      "type": "string",
                      "enum": [
                        "past",
                        "future",
                        "current"
                      ],
                      "default": "past"
                    }
                  },
                  "required": [
                    "unit",
                    "value"
                  ],
                  "additionalProperties": false
                },
                "text": {
                  "type": "string",
                  "description": "Original timeframe text"
                }
              },
              "required": [
                "type",
                "text"
              ],
              "additionalProperties": false
            },
            "ast": {
              "type": "object",
              "additionalProperties": {},
              "description": "Generated ObjectQL AST"
            },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Overall confidence"
            },
            "ambiguities": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "suggestions": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "type",
                  "description"
                ],
                "additionalProperties": false
              },
              "description": "Detected ambiguities requiring clarification"
            },
            "alternatives": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "interpretation": {
                    "type": "string"
                  },
                  "confidence": {
                    "type": "number"
                  },
                  "ast": {}
                },
                "required": [
                  "interpretation",
                  "confidence"
                ],
                "additionalProperties": false
              }
            }
          },
          "required": [
            "originalQuery",
            "intent",
            "intentConfidence",
            "entities",
            "ast",
            "confidence"
          ],
          "additionalProperties": false
        },
        "results": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": {}
          },
          "description": "Query results"
        },
        "totalCount": {
          "type": "integer"
        },
        "executionTime": {
          "type": "number",
          "description": "Execution time in milliseconds"
        },
        "needsClarification": {
          "type": "boolean",
          "description": "Whether query needs clarification"
        },
        "tokens": {
          "type": "object",
          "properties": {
            "prompt": {
              "type": "integer",
              "minimum": 0,
              "description": "Input tokens"
            },
            "completion": {
              "type": "integer",
              "minimum": 0,
              "description": "Output tokens"
            },
            "total": {
              "type": "integer",
              "minimum": 0,
              "description": "Total tokens"
            }
          },
          "required": [
            "prompt",
            "completion",
            "total"
          ],
          "additionalProperties": false,
          "description": "Token usage for this query"
        },
        "cost": {
          "type": "number",
          "minimum": 0,
          "description": "Cost for this query in USD"
        },
        "suggestions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Query refinement suggestions"
        }
      },
      "required": [
        "parseResult",
        "needsClarification"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}