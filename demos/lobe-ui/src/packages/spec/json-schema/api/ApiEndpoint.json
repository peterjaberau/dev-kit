{
  "$ref": "#/definitions/ApiEndpoint",
  "definitions": {
    "ApiEndpoint": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z_][a-z0-9_]*$",
          "description": "Unique endpoint ID"
        },
        "path": {
          "type": "string",
          "pattern": "^\\/",
          "description": "URL Path (e.g. /api/v1/customers)"
        },
        "method": {
          "type": "string",
          "enum": [
            "GET",
            "POST",
            "PUT",
            "DELETE",
            "PATCH",
            "HEAD",
            "OPTIONS"
          ],
          "description": "HTTP Method"
        },
        "summary": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "flow",
            "script",
            "object_operation",
            "proxy"
          ],
          "description": "Implementation type"
        },
        "target": {
          "type": "string",
          "description": "Target Flow ID, Script Name, or Proxy URL"
        },
        "objectParams": {
          "type": "object",
          "properties": {
            "object": {
              "type": "string"
            },
            "operation": {
              "type": "string",
              "enum": [
                "find",
                "get",
                "create",
                "update",
                "delete"
              ]
            }
          },
          "additionalProperties": false,
          "description": "For object_operation type"
        },
        "inputMapping": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "source": {
                "type": "string",
                "description": "Source field/path"
              },
              "target": {
                "type": "string",
                "description": "Target field/path"
              },
              "transform": {
                "type": "string",
                "description": "Transformation function name"
              }
            },
            "required": [
              "source",
              "target"
            ],
            "additionalProperties": false
          },
          "description": "Map Request Body to Internal Params"
        },
        "outputMapping": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "source": {
                "type": "string",
                "description": "Source field/path"
              },
              "target": {
                "type": "string",
                "description": "Target field/path"
              },
              "transform": {
                "type": "string",
                "description": "Transformation function name"
              }
            },
            "required": [
              "source",
              "target"
            ],
            "additionalProperties": false
          },
          "description": "Map Internal Result to Response Body"
        },
        "authRequired": {
          "type": "boolean",
          "default": true,
          "description": "Require authentication"
        },
        "rateLimit": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable rate limiting"
            },
            "windowMs": {
              "type": "integer",
              "default": 60000,
              "description": "Time window in milliseconds"
            },
            "maxRequests": {
              "type": "integer",
              "default": 100,
              "description": "Max requests per window"
            }
          },
          "additionalProperties": false,
          "description": "Rate limiting policy"
        },
        "cacheTtl": {
          "type": "number",
          "description": "Response cache TTL in seconds"
        }
      },
      "required": [
        "name",
        "path",
        "method",
        "type",
        "target"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}