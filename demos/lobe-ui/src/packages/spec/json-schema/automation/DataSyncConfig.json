{
  "$ref": "#/definitions/DataSyncConfig",
  "definitions": {
    "DataSyncConfig": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z_][a-z0-9_]*$",
          "description": "Sync configuration name (snake_case)"
        },
        "label": {
          "type": "string",
          "description": "Sync display name"
        },
        "description": {
          "type": "string",
          "description": "Sync description"
        },
        "source": {
          "type": "object",
          "properties": {
            "object": {
              "type": "string",
              "description": "ObjectStack object name"
            },
            "filters": {
              "description": "Filter conditions"
            },
            "fields": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Fields to sync"
            },
            "connectorInstanceId": {
              "type": "string",
              "description": "Connector instance ID"
            },
            "externalResource": {
              "type": "string",
              "description": "External resource ID"
            }
          },
          "additionalProperties": false,
          "description": "Data source"
        },
        "destination": {
          "type": "object",
          "properties": {
            "object": {
              "type": "string",
              "description": "ObjectStack object name"
            },
            "connectorInstanceId": {
              "type": "string",
              "description": "Connector instance ID"
            },
            "operation": {
              "type": "string",
              "enum": [
                "insert",
                "update",
                "upsert",
                "delete",
                "sync"
              ],
              "description": "Sync operation"
            },
            "mapping": {
              "anyOf": [
                {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "source": {
                        "type": "string",
                        "description": "Source field name"
                      },
                      "target": {
                        "type": "string",
                        "description": "Target field name"
                      },
                      "transform": {
                        "anyOf": [
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "constant"
                              },
                              "value": {
                                "description": "Constant value to use"
                              }
                            },
                            "required": [
                              "type"
                            ],
                            "additionalProperties": false,
                            "description": "Set a constant value"
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "cast"
                              },
                              "targetType": {
                                "type": "string",
                                "enum": [
                                  "string",
                                  "number",
                                  "boolean",
                                  "date"
                                ],
                                "description": "Target data type"
                              }
                            },
                            "required": [
                              "type",
                              "targetType"
                            ],
                            "additionalProperties": false,
                            "description": "Cast to a specific data type"
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "lookup"
                              },
                              "table": {
                                "type": "string",
                                "description": "Lookup table name"
                              },
                              "keyField": {
                                "type": "string",
                                "description": "Field to match on"
                              },
                              "valueField": {
                                "type": "string",
                                "description": "Field to retrieve"
                              }
                            },
                            "required": [
                              "type",
                              "table",
                              "keyField",
                              "valueField"
                            ],
                            "additionalProperties": false,
                            "description": "Lookup value from another table"
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "javascript"
                              },
                              "expression": {
                                "type": "string",
                                "description": "JavaScript expression (e.g., \"value.toUpperCase()\")"
                              }
                            },
                            "required": [
                              "type",
                              "expression"
                            ],
                            "additionalProperties": false,
                            "description": "Custom JavaScript transformation"
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "map"
                              },
                              "mappings": {
                                "type": "object",
                                "additionalProperties": {},
                                "description": "Value mappings (e.g., {\"Active\": \"active\"})"
                              }
                            },
                            "required": [
                              "type",
                              "mappings"
                            ],
                            "additionalProperties": false,
                            "description": "Map values using a dictionary"
                          }
                        ],
                        "description": "Transformation to apply"
                      },
                      "defaultValue": {
                        "description": "Default if source is null/undefined"
                      }
                    },
                    "required": [
                      "source",
                      "target"
                    ],
                    "additionalProperties": false
                  }
                }
              ],
              "description": "Field mappings"
            },
            "externalResource": {
              "type": "string",
              "description": "External resource ID"
            },
            "matchKey": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Match key fields"
            }
          },
          "required": [
            "operation"
          ],
          "additionalProperties": false,
          "description": "Data destination"
        },
        "direction": {
          "type": "string",
          "enum": [
            "push",
            "pull",
            "bidirectional"
          ],
          "default": "push",
          "description": "Sync direction"
        },
        "syncMode": {
          "type": "string",
          "enum": [
            "full",
            "incremental",
            "realtime"
          ],
          "default": "incremental",
          "description": "Sync mode"
        },
        "conflictResolution": {
          "type": "string",
          "enum": [
            "source_wins",
            "destination_wins",
            "latest_wins",
            "manual",
            "merge"
          ],
          "default": "latest_wins",
          "description": "Conflict resolution"
        },
        "schedule": {
          "type": "string",
          "description": "Cron schedule"
        },
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Sync enabled"
        },
        "changeTrackingField": {
          "type": "string",
          "description": "Field for change tracking"
        },
        "batchSize": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10000,
          "default": 100,
          "description": "Batch size for processing"
        },
        "retry": {
          "type": "object",
          "properties": {
            "maxAttempts": {
              "type": "integer",
              "minimum": 0,
              "default": 3,
              "description": "Max retries"
            },
            "backoffMs": {
              "type": "integer",
              "minimum": 0,
              "default": 30000,
              "description": "Backoff duration"
            }
          },
          "additionalProperties": false,
          "description": "Retry configuration"
        },
        "validation": {
          "type": "object",
          "properties": {
            "required": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Required fields"
            },
            "unique": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Unique constraint fields"
            },
            "custom": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "condition": {
                    "type": "string",
                    "description": "Validation condition"
                  },
                  "message": {
                    "type": "string",
                    "description": "Error message"
                  }
                },
                "required": [
                  "name",
                  "condition",
                  "message"
                ],
                "additionalProperties": false
              },
              "description": "Custom validation rules"
            }
          },
          "additionalProperties": false,
          "description": "Validation rules"
        },
        "errorHandling": {
          "type": "object",
          "properties": {
            "onValidationError": {
              "type": "string",
              "enum": [
                "skip",
                "fail",
                "log"
              ],
              "default": "skip"
            },
            "onSyncError": {
              "type": "string",
              "enum": [
                "skip",
                "fail",
                "retry"
              ],
              "default": "retry"
            },
            "notifyOnError": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Email notifications"
            }
          },
          "additionalProperties": false,
          "description": "Error handling"
        },
        "optimization": {
          "type": "object",
          "properties": {
            "parallelBatches": {
              "type": "boolean",
              "default": false,
              "description": "Process batches in parallel"
            },
            "cacheEnabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable caching"
            },
            "compressionEnabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable compression"
            }
          },
          "additionalProperties": false,
          "description": "Performance optimization"
        },
        "audit": {
          "type": "object",
          "properties": {
            "logLevel": {
              "type": "string",
              "enum": [
                "none",
                "error",
                "warn",
                "info",
                "debug"
              ],
              "default": "info"
            },
            "retainLogsForDays": {
              "type": "integer",
              "minimum": 1,
              "default": 30
            },
            "trackChanges": {
              "type": "boolean",
              "default": true,
              "description": "Track all changes"
            }
          },
          "additionalProperties": false,
          "description": "Audit configuration"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Sync tags"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {},
          "description": "Custom metadata"
        }
      },
      "required": [
        "name",
        "source",
        "destination"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}