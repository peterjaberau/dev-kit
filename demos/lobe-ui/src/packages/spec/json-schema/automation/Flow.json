{
  "$ref": "#/definitions/Flow",
  "definitions": {
    "Flow": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z_][a-z0-9_]*$",
          "description": "Machine name"
        },
        "label": {
          "type": "string",
          "description": "Flow label"
        },
        "description": {
          "type": "string"
        },
        "version": {
          "type": "integer",
          "default": 1,
          "description": "Version number"
        },
        "status": {
          "type": "string",
          "enum": [
            "draft",
            "active",
            "obsolete",
            "invalid"
          ],
          "default": "draft",
          "description": "Deployment status"
        },
        "template": {
          "type": "boolean",
          "default": false,
          "description": "Is logic template (Subflow)"
        },
        "type": {
          "type": "string",
          "enum": [
            "autolaunched",
            "record_change",
            "schedule",
            "screen",
            "api"
          ],
          "description": "Flow type"
        },
        "variables": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Variable name"
              },
              "type": {
                "type": "string",
                "description": "Data type (text, number, boolean, object, list)"
              },
              "isInput": {
                "type": "boolean",
                "default": false,
                "description": "Is input parameter"
              },
              "isOutput": {
                "type": "boolean",
                "default": false,
                "description": "Is output parameter"
              }
            },
            "required": [
              "name",
              "type"
            ],
            "additionalProperties": false
          },
          "description": "Flow variables"
        },
        "nodes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Node unique ID"
              },
              "type": {
                "type": "string",
                "enum": [
                  "start",
                  "end",
                  "decision",
                  "assignment",
                  "loop",
                  "create_record",
                  "update_record",
                  "delete_record",
                  "get_record",
                  "http_request",
                  "script",
                  "wait",
                  "subflow",
                  "connector_action"
                ],
                "description": "Action type"
              },
              "label": {
                "type": "string",
                "description": "Node label"
              },
              "config": {
                "type": "object",
                "additionalProperties": {},
                "description": "Node configuration"
              },
              "connectorConfig": {
                "type": "object",
                "properties": {
                  "connectorId": {
                    "type": "string"
                  },
                  "actionId": {
                    "type": "string"
                  },
                  "input": {
                    "type": "object",
                    "additionalProperties": {},
                    "description": "Mapped inputs for the action"
                  }
                },
                "required": [
                  "connectorId",
                  "actionId",
                  "input"
                ],
                "additionalProperties": false
              },
              "position": {
                "type": "object",
                "properties": {
                  "x": {
                    "type": "number"
                  },
                  "y": {
                    "type": "number"
                  }
                },
                "required": [
                  "x",
                  "y"
                ],
                "additionalProperties": false
              }
            },
            "required": [
              "id",
              "type",
              "label"
            ],
            "additionalProperties": false
          },
          "description": "Flow nodes"
        },
        "edges": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Edge unique ID"
              },
              "source": {
                "type": "string",
                "description": "Source Node ID"
              },
              "target": {
                "type": "string",
                "description": "Target Node ID"
              },
              "condition": {
                "type": "string",
                "description": "Expression returning boolean used for branching"
              },
              "type": {
                "type": "string",
                "enum": [
                  "default",
                  "fault"
                ],
                "default": "default",
                "description": "Connection type: Standard (Success) or Fault (Error) path"
              },
              "label": {
                "type": "string",
                "description": "Label on the connector"
              }
            },
            "required": [
              "id",
              "source",
              "target"
            ],
            "additionalProperties": false
          },
          "description": "Flow connections"
        },
        "active": {
          "type": "boolean",
          "default": false,
          "description": "Is active (Deprecated: use status)"
        },
        "runAs": {
          "type": "string",
          "enum": [
            "system",
            "user"
          ],
          "default": "user",
          "description": "Execution context"
        }
      },
      "required": [
        "name",
        "label",
        "type",
        "nodes",
        "edges"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}