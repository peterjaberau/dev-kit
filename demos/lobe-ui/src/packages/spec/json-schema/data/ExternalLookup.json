{
  "$ref": "#/definitions/ExternalLookup",
  "definitions": {
    "ExternalLookup": {
      "type": "object",
      "properties": {
        "fieldName": {
          "type": "string",
          "description": "Field name"
        },
        "dataSource": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "description": "Data source ID"
            },
            "name": {
              "type": "string",
              "description": "Data source name"
            },
            "type": {
              "type": "string",
              "enum": [
                "odata",
                "rest-api",
                "graphql",
                "custom"
              ],
              "description": "Protocol type"
            },
            "endpoint": {
              "type": "string",
              "format": "uri",
              "description": "API endpoint URL"
            },
            "authentication": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "oauth2",
                    "api-key",
                    "basic",
                    "none"
                  ],
                  "description": "Auth type"
                },
                "config": {
                  "type": "object",
                  "additionalProperties": {},
                  "description": "Auth configuration"
                }
              },
              "required": [
                "type",
                "config"
              ],
              "additionalProperties": false,
              "description": "Authentication"
            }
          },
          "required": [
            "id",
            "name",
            "type",
            "endpoint",
            "authentication"
          ],
          "additionalProperties": false,
          "description": "External data source"
        },
        "query": {
          "type": "object",
          "properties": {
            "endpoint": {
              "type": "string",
              "description": "Query endpoint path"
            },
            "method": {
              "type": "string",
              "enum": [
                "GET",
                "POST"
              ],
              "default": "GET",
              "description": "HTTP method"
            },
            "parameters": {
              "type": "object",
              "additionalProperties": {},
              "description": "Query parameters"
            }
          },
          "required": [
            "endpoint"
          ],
          "additionalProperties": false,
          "description": "Query configuration"
        },
        "fieldMappings": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "source": {
                "type": "string",
                "description": "Source field name"
              },
              "target": {
                "type": "string",
                "description": "Target field name"
              },
              "transform": {
                "anyOf": [
                  {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "const": "constant"
                      },
                      "value": {
                        "description": "Constant value to use"
                      }
                    },
                    "required": [
                      "type"
                    ],
                    "additionalProperties": false,
                    "description": "Set a constant value"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "const": "cast"
                      },
                      "targetType": {
                        "type": "string",
                        "enum": [
                          "string",
                          "number",
                          "boolean",
                          "date"
                        ],
                        "description": "Target data type"
                      }
                    },
                    "required": [
                      "type",
                      "targetType"
                    ],
                    "additionalProperties": false,
                    "description": "Cast to a specific data type"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "const": "lookup"
                      },
                      "table": {
                        "type": "string",
                        "description": "Lookup table name"
                      },
                      "keyField": {
                        "type": "string",
                        "description": "Field to match on"
                      },
                      "valueField": {
                        "type": "string",
                        "description": "Field to retrieve"
                      }
                    },
                    "required": [
                      "type",
                      "table",
                      "keyField",
                      "valueField"
                    ],
                    "additionalProperties": false,
                    "description": "Lookup value from another table"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "const": "javascript"
                      },
                      "expression": {
                        "type": "string",
                        "description": "JavaScript expression (e.g., \"value.toUpperCase()\")"
                      }
                    },
                    "required": [
                      "type",
                      "expression"
                    ],
                    "additionalProperties": false,
                    "description": "Custom JavaScript transformation"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "const": "map"
                      },
                      "mappings": {
                        "type": "object",
                        "additionalProperties": {},
                        "description": "Value mappings (e.g., {\"Active\": \"active\"})"
                      }
                    },
                    "required": [
                      "type",
                      "mappings"
                    ],
                    "additionalProperties": false,
                    "description": "Map values using a dictionary"
                  }
                ],
                "description": "Transformation to apply"
              },
              "defaultValue": {
                "description": "Default if source is null/undefined"
              },
              "type": {
                "type": "string",
                "description": "Field type"
              },
              "readonly": {
                "type": "boolean",
                "default": true,
                "description": "Read-only field"
              }
            },
            "required": [
              "source",
              "target"
            ],
            "additionalProperties": false
          },
          "description": "Field mappings"
        },
        "caching": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Cache enabled"
            },
            "ttl": {
              "type": "number",
              "default": 300,
              "description": "Cache TTL (seconds)"
            },
            "strategy": {
              "type": "string",
              "enum": [
                "lru",
                "lfu",
                "ttl"
              ],
              "default": "ttl",
              "description": "Cache strategy"
            }
          },
          "additionalProperties": false,
          "description": "Caching configuration"
        },
        "fallback": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Fallback enabled"
            },
            "defaultValue": {
              "description": "Default fallback value"
            },
            "showError": {
              "type": "boolean",
              "default": true,
              "description": "Show error to user"
            }
          },
          "additionalProperties": false,
          "description": "Fallback configuration"
        },
        "rateLimit": {
          "type": "object",
          "properties": {
            "requestsPerSecond": {
              "type": "number",
              "description": "Requests per second limit"
            },
            "burstSize": {
              "type": "number",
              "description": "Burst size"
            }
          },
          "required": [
            "requestsPerSecond"
          ],
          "additionalProperties": false,
          "description": "Rate limiting"
        }
      },
      "required": [
        "fieldName",
        "dataSource",
        "query",
        "fieldMappings"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}