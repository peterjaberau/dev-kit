{
  "$ref": "#/definitions/TenantIsolationConfig",
  "definitions": {
    "TenantIsolationConfig": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "strategy": {
              "type": "string",
              "const": "shared_schema",
              "description": "Row-level isolation strategy"
            },
            "database": {
              "type": "object",
              "properties": {
                "enableRLS": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable PostgreSQL Row-Level Security"
                },
                "contextMethod": {
                  "type": "string",
                  "enum": [
                    "session_variable",
                    "search_path",
                    "application_name"
                  ],
                  "default": "session_variable",
                  "description": "How to set tenant context"
                },
                "contextVariable": {
                  "type": "string",
                  "default": "app.current_tenant",
                  "description": "Session variable name"
                },
                "applicationValidation": {
                  "type": "boolean",
                  "default": true,
                  "description": "Application-level tenant validation"
                }
              },
              "additionalProperties": false,
              "description": "Database configuration"
            },
            "performance": {
              "type": "object",
              "properties": {
                "usePartialIndexes": {
                  "type": "boolean",
                  "default": true,
                  "description": "Use partial indexes per tenant"
                },
                "usePartitioning": {
                  "type": "boolean",
                  "default": false,
                  "description": "Use table partitioning by tenant_id"
                },
                "poolSizePerTenant": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "description": "Connection pool size per tenant"
                }
              },
              "additionalProperties": false,
              "description": "Performance settings"
            }
          },
          "required": [
            "strategy"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "strategy": {
              "type": "string",
              "const": "isolated_schema",
              "description": "Schema-level isolation strategy"
            },
            "schema": {
              "type": "object",
              "properties": {
                "namingPattern": {
                  "type": "string",
                  "default": "tenant_{tenant_id}",
                  "description": "Schema naming pattern"
                },
                "includePublicSchema": {
                  "type": "boolean",
                  "default": true,
                  "description": "Include public schema"
                },
                "sharedSchema": {
                  "type": "string",
                  "default": "public",
                  "description": "Schema for shared resources"
                },
                "autoCreateSchema": {
                  "type": "boolean",
                  "default": true,
                  "description": "Auto-create schema"
                }
              },
              "additionalProperties": false,
              "description": "Schema configuration"
            },
            "migrations": {
              "type": "object",
              "properties": {
                "strategy": {
                  "type": "string",
                  "enum": [
                    "parallel",
                    "sequential",
                    "on_demand"
                  ],
                  "default": "parallel",
                  "description": "Migration strategy"
                },
                "maxConcurrent": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 10,
                  "description": "Max concurrent migrations"
                },
                "rollbackOnError": {
                  "type": "boolean",
                  "default": true,
                  "description": "Rollback on error"
                }
              },
              "additionalProperties": false,
              "description": "Migration configuration"
            },
            "performance": {
              "type": "object",
              "properties": {
                "poolPerSchema": {
                  "type": "boolean",
                  "default": false,
                  "description": "Separate pool per schema"
                },
                "schemaCacheTTL": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 3600,
                  "description": "Schema cache TTL"
                }
              },
              "additionalProperties": false,
              "description": "Performance settings"
            }
          },
          "required": [
            "strategy"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "strategy": {
              "type": "string",
              "const": "isolated_db",
              "description": "Database-level isolation strategy"
            },
            "database": {
              "type": "object",
              "properties": {
                "namingPattern": {
                  "type": "string",
                  "default": "tenant_{tenant_id}",
                  "description": "Database naming pattern"
                },
                "serverStrategy": {
                  "type": "string",
                  "enum": [
                    "shared",
                    "sharded",
                    "dedicated"
                  ],
                  "default": "shared",
                  "description": "Server assignment strategy"
                },
                "separateCredentials": {
                  "type": "boolean",
                  "default": true,
                  "description": "Separate credentials per tenant"
                },
                "autoCreateDatabase": {
                  "type": "boolean",
                  "default": true,
                  "description": "Auto-create database"
                }
              },
              "additionalProperties": false,
              "description": "Database configuration"
            },
            "connectionPool": {
              "type": "object",
              "properties": {
                "poolSize": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 10,
                  "description": "Connection pool size"
                },
                "maxActivePools": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 100,
                  "description": "Max active pools"
                },
                "idleTimeout": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 300,
                  "description": "Idle pool timeout"
                },
                "usePooler": {
                  "type": "boolean",
                  "default": true,
                  "description": "Use connection pooler"
                }
              },
              "additionalProperties": false,
              "description": "Connection pool configuration"
            },
            "backup": {
              "type": "object",
              "properties": {
                "strategy": {
                  "type": "string",
                  "enum": [
                    "individual",
                    "consolidated",
                    "on_demand"
                  ],
                  "default": "individual",
                  "description": "Backup strategy"
                },
                "frequencyHours": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 24,
                  "description": "Backup frequency"
                },
                "retentionDays": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "default": 30,
                  "description": "Backup retention days"
                }
              },
              "additionalProperties": false,
              "description": "Backup configuration"
            },
            "encryption": {
              "type": "object",
              "properties": {
                "perTenantKeys": {
                  "type": "boolean",
                  "default": false,
                  "description": "Per-tenant encryption keys"
                },
                "algorithm": {
                  "type": "string",
                  "default": "AES-256-GCM",
                  "description": "Encryption algorithm"
                },
                "keyManagement": {
                  "type": "string",
                  "enum": [
                    "aws_kms",
                    "azure_key_vault",
                    "gcp_kms",
                    "hashicorp_vault",
                    "custom"
                  ],
                  "description": "Key management service"
                }
              },
              "additionalProperties": false,
              "description": "Encryption configuration"
            }
          },
          "required": [
            "strategy"
          ],
          "additionalProperties": false
        }
      ]
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}