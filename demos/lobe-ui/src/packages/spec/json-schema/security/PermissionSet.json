{
  "$ref": "#/definitions/PermissionSet",
  "definitions": {
    "PermissionSet": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 2,
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Permission set unique name (lowercase snake_case)"
        },
        "label": {
          "type": "string",
          "description": "Display label"
        },
        "isProfile": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a user profile"
        },
        "objects": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "allowCreate": {
                "type": "boolean",
                "default": false,
                "description": "Create permission"
              },
              "allowRead": {
                "type": "boolean",
                "default": false,
                "description": "Read permission"
              },
              "allowEdit": {
                "type": "boolean",
                "default": false,
                "description": "Edit permission"
              },
              "allowDelete": {
                "type": "boolean",
                "default": false,
                "description": "Delete permission"
              },
              "allowTransfer": {
                "type": "boolean",
                "default": false,
                "description": "Change record ownership"
              },
              "allowRestore": {
                "type": "boolean",
                "default": false,
                "description": "Restore from trash (Undelete)"
              },
              "allowPurge": {
                "type": "boolean",
                "default": false,
                "description": "Permanently delete (Hard Delete/GDPR)"
              },
              "viewAllRecords": {
                "type": "boolean",
                "default": false,
                "description": "View All Data (Bypass Sharing)"
              },
              "modifyAllRecords": {
                "type": "boolean",
                "default": false,
                "description": "Modify All Data (Bypass Sharing)"
              }
            },
            "additionalProperties": false
          },
          "description": "Entity permissions"
        },
        "fields": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "readable": {
                "type": "boolean",
                "default": true,
                "description": "Field read access"
              },
              "editable": {
                "type": "boolean",
                "default": false,
                "description": "Field edit access"
              }
            },
            "additionalProperties": false
          },
          "description": "Field level security"
        },
        "systemPermissions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "System level capabilities"
        },
        "rowLevelSecurity": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "pattern": "^[a-z_][a-z0-9_]*$",
                "description": "Policy unique identifier (snake_case)"
              },
              "label": {
                "type": "string",
                "description": "Human-readable policy label"
              },
              "description": {
                "type": "string",
                "description": "Policy description and business justification"
              },
              "object": {
                "type": "string",
                "description": "Target object name"
              },
              "operation": {
                "type": "string",
                "enum": [
                  "select",
                  "insert",
                  "update",
                  "delete",
                  "all"
                ],
                "description": "Database operation this policy applies to"
              },
              "using": {
                "type": "string",
                "description": "Filter condition for SELECT/UPDATE/DELETE (PostgreSQL SQL WHERE clause syntax with parameterized context variables). Optional for INSERT-only policies."
              },
              "check": {
                "type": "string",
                "description": "Validation condition for INSERT/UPDATE (defaults to USING clause if not specified - enforced at application level)"
              },
              "roles": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Roles this policy applies to (omit for all roles)"
              },
              "enabled": {
                "type": "boolean",
                "default": true,
                "description": "Whether this policy is active"
              },
              "priority": {
                "type": "integer",
                "default": 0,
                "description": "Policy evaluation priority (higher = evaluated first)"
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Policy categorization tags"
              }
            },
            "required": [
              "name",
              "object",
              "operation"
            ],
            "additionalProperties": false
          },
          "description": "Row-level security policies (see rls.zod.ts for full spec)"
        },
        "contextVariables": {
          "type": "object",
          "additionalProperties": {},
          "description": "Context variables for RLS evaluation"
        }
      },
      "required": [
        "name",
        "objects"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}