{
  "$ref": "#/definitions/CRDTMergeResult",
  "definitions": {
    "CRDTMergeResult": {
      "type": "object",
      "properties": {
        "state": {
          "anyOf": [
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "lww-register"
                },
                "value": {
                  "description": "Current register value"
                },
                "timestamp": {
                  "type": "string",
                  "format": "date-time",
                  "description": "ISO 8601 datetime of last write"
                },
                "replicaId": {
                  "type": "string",
                  "description": "ID of replica that performed last write"
                },
                "vectorClock": {
                  "type": "object",
                  "properties": {
                    "clock": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "description": "Map of replica ID to logical timestamp"
                    }
                  },
                  "required": [
                    "clock"
                  ],
                  "additionalProperties": false,
                  "description": "Optional vector clock for causality tracking"
                }
              },
              "required": [
                "type",
                "timestamp",
                "replicaId"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "g-counter"
                },
                "counts": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "description": "Map of replica ID to count"
                }
              },
              "required": [
                "type",
                "counts"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "pn-counter"
                },
                "positive": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "description": "Positive increments per replica"
                },
                "negative": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "description": "Negative increments per replica"
                }
              },
              "required": [
                "type",
                "positive",
                "negative"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "or-set"
                },
                "elements": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "value": {
                        "description": "Element value"
                      },
                      "timestamp": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Addition timestamp"
                      },
                      "replicaId": {
                        "type": "string",
                        "description": "Replica that added the element"
                      },
                      "uid": {
                        "type": "string",
                        "format": "uuid",
                        "description": "Unique identifier for this addition"
                      },
                      "removed": {
                        "type": "boolean",
                        "default": false,
                        "description": "Whether element has been removed"
                      }
                    },
                    "required": [
                      "timestamp",
                      "replicaId",
                      "uid"
                    ],
                    "additionalProperties": false
                  },
                  "description": "Set elements with metadata"
                }
              },
              "required": [
                "type",
                "elements"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "text"
                },
                "documentId": {
                  "type": "string",
                  "description": "Document identifier"
                },
                "content": {
                  "type": "string",
                  "description": "Current text content"
                },
                "operations": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "operationId": {
                        "type": "string",
                        "format": "uuid",
                        "description": "Unique operation identifier"
                      },
                      "replicaId": {
                        "type": "string",
                        "description": "Replica identifier"
                      },
                      "position": {
                        "type": "integer",
                        "minimum": 0,
                        "description": "Position in document"
                      },
                      "insert": {
                        "type": "string",
                        "description": "Text to insert"
                      },
                      "delete": {
                        "type": "integer",
                        "exclusiveMinimum": 0,
                        "description": "Number of characters to delete"
                      },
                      "timestamp": {
                        "type": "string",
                        "format": "date-time",
                        "description": "ISO 8601 datetime of operation"
                      },
                      "lamportTimestamp": {
                        "type": "integer",
                        "minimum": 0,
                        "description": "Lamport timestamp for ordering"
                      }
                    },
                    "required": [
                      "operationId",
                      "replicaId",
                      "position",
                      "timestamp",
                      "lamportTimestamp"
                    ],
                    "additionalProperties": false
                  },
                  "description": "History of operations"
                },
                "lamportClock": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Current Lamport clock value"
                },
                "vectorClock": {
                  "type": "object",
                  "properties": {
                    "clock": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "description": "Map of replica ID to logical timestamp"
                    }
                  },
                  "required": [
                    "clock"
                  ],
                  "additionalProperties": false,
                  "description": "Vector clock for causality"
                }
              },
              "required": [
                "type",
                "documentId",
                "content",
                "operations",
                "lamportClock",
                "vectorClock"
              ],
              "additionalProperties": false
            }
          ],
          "description": "Merged CRDT state"
        },
        "conflicts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "Conflict type"
              },
              "description": {
                "type": "string",
                "description": "Conflict description"
              },
              "resolved": {
                "type": "boolean",
                "description": "Whether conflict was automatically resolved"
              }
            },
            "required": [
              "type",
              "description",
              "resolved"
            ],
            "additionalProperties": false
          },
          "description": "Conflicts encountered during merge"
        }
      },
      "required": [
        "state"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}