{
  "$ref": "#/definitions/WidgetManifest",
  "definitions": {
    "WidgetManifest": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z_][a-z0-9_]*$",
          "description": "Widget identifier (snake_case)"
        },
        "label": {
          "type": "string",
          "description": "Widget display name"
        },
        "description": {
          "type": "string",
          "description": "Widget description"
        },
        "version": {
          "type": "string",
          "description": "Widget version (semver)"
        },
        "author": {
          "type": "string",
          "description": "Widget author"
        },
        "icon": {
          "type": "string",
          "description": "Widget icon"
        },
        "fieldTypes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Supported field types"
        },
        "category": {
          "type": "string",
          "enum": [
            "input",
            "display",
            "picker",
            "editor",
            "custom"
          ],
          "default": "custom",
          "description": "Widget category"
        },
        "lifecycle": {
          "type": "object",
          "properties": {
            "onMount": {
              "type": "string",
              "description": "Initialization code when widget mounts"
            },
            "onUpdate": {
              "type": "string",
              "description": "Code to run when props change"
            },
            "onUnmount": {
              "type": "string",
              "description": "Cleanup code when widget unmounts"
            },
            "onValidate": {
              "type": "string",
              "description": "Custom validation logic"
            },
            "onFocus": {
              "type": "string",
              "description": "Code to run on focus"
            },
            "onBlur": {
              "type": "string",
              "description": "Code to run on blur"
            },
            "onError": {
              "type": "string",
              "description": "Error handling code"
            }
          },
          "additionalProperties": false,
          "description": "Lifecycle hooks"
        },
        "events": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Event name"
              },
              "label": {
                "type": "string",
                "description": "Human-readable event label"
              },
              "description": {
                "type": "string",
                "description": "Event description and usage"
              },
              "bubbles": {
                "type": "boolean",
                "default": false,
                "description": "Whether event bubbles"
              },
              "cancelable": {
                "type": "boolean",
                "default": false,
                "description": "Whether event is cancelable"
              },
              "payload": {
                "type": "object",
                "additionalProperties": {},
                "description": "Event payload schema"
              }
            },
            "required": [
              "name"
            ],
            "additionalProperties": false
          },
          "description": "Custom events"
        },
        "properties": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Property name (camelCase)"
              },
              "label": {
                "type": "string",
                "description": "Human-readable label"
              },
              "type": {
                "type": "string",
                "enum": [
                  "string",
                  "number",
                  "boolean",
                  "array",
                  "object",
                  "function",
                  "any"
                ],
                "description": "TypeScript type"
              },
              "required": {
                "type": "boolean",
                "default": false,
                "description": "Whether property is required"
              },
              "default": {
                "description": "Default value"
              },
              "description": {
                "type": "string",
                "description": "Property description"
              },
              "validation": {
                "type": "object",
                "additionalProperties": {},
                "description": "Validation rules"
              },
              "category": {
                "type": "string",
                "description": "Property category"
              }
            },
            "required": [
              "name",
              "type"
            ],
            "additionalProperties": false
          },
          "description": "Configuration properties"
        },
        "implementation": {
          "anyOf": [
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "npm"
                },
                "packageName": {
                  "type": "string",
                  "description": "NPM package name"
                },
                "version": {
                  "type": "string",
                  "default": "latest"
                },
                "exportName": {
                  "type": "string",
                  "description": "Named export (default: default)"
                }
              },
              "required": [
                "type",
                "packageName"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "remote"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "Remote entry URL (.js)"
                },
                "moduleName": {
                  "type": "string",
                  "description": "Exposed module name"
                },
                "scope": {
                  "type": "string",
                  "description": "Remote scope name"
                }
              },
              "required": [
                "type",
                "url",
                "moduleName",
                "scope"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "inline"
                },
                "code": {
                  "type": "string",
                  "description": "JavaScript code body"
                }
              },
              "required": [
                "type",
                "code"
              ],
              "additionalProperties": false
            }
          ],
          "description": "Widget implementation source"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "version": {
                "type": "string"
              },
              "url": {
                "type": "string",
                "format": "uri"
              }
            },
            "required": [
              "name"
            ],
            "additionalProperties": false
          },
          "description": "Widget dependencies"
        },
        "screenshots": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          },
          "description": "Screenshot URLs"
        },
        "documentation": {
          "type": "string",
          "format": "uri",
          "description": "Documentation URL"
        },
        "license": {
          "type": "string",
          "description": "License (SPDX identifier)"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Tags for categorization"
        }
      },
      "required": [
        "name",
        "label"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}